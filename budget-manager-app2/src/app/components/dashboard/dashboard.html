<section class="dashboard-section">
  <h2>ğŸ“Š AperÃ§u du Budget</h2>

  <div class="balance-card" [ngClass]="getStatusClass(balanceStatus$ | async)">
    <p>Solde actuel (filtrÃ©) :</p>
    <p class="balance-amount">{{ totalBalance$ | async | number:'1.2-2' }} â‚¬</p>
    <p class="status-message" *ngIf="(balanceStatus$ | async) === 'rouge'">
      Attention : Vous Ãªtes dans le rouge ce mois-ci !
    </p>
  </div>
  
  <div class="dashboard-grid">
    
    <div class="top-expenses card">
      <h3>ğŸ”¥ Top 3 DÃ©penses</h3>
      <div *ngIf="(top3Expenses$ | async)?.length === 0" class="no-data">
        Aucune dÃ©pense enregistrÃ©e (ou filtrÃ©e).
      </div>
      <ul>
        <li *ngFor="let expense of top3Expenses$ | async">
          <strong>{{ expense.category }}:</strong> 
          <span>{{ expense.totalAmount | number:'1.2-2' }} â‚¬</span>
        </li>
      </ul>
    </div>
    
    <div class="filters card">
      <h3>ğŸ” Filtres</h3>
      <div class="filter-group">
        <label for="month-filter">Filtrer par Mois :</label>
        <input id="month-filter" type="month" [(ngModel)]="selectedMonth" (ngModelChange)="applyFilters()">
      </div>
      
      <div class="filter-group">
        <label for="category-filter">Filtrer par CatÃ©gorie :</label>
        <select id="category-filter" [(ngModel)]="selectedCategory" (ngModelChange)="applyFilters()">
          <option value="">Toutes les catÃ©gories</option>
          <option *ngFor="let cat of allCategories" [value]="cat">{{ cat }}</option>
        </select>
      </div>
    </div>
  </div>


  <h3>ğŸ“œ Liste des Transactions ({{ (filteredTransactions$ | async)?.length || 0 }} Ã©lÃ©ments)</h3>
  <table>
    <thead>
      <tr>
        <th>Date</th>
        <th>CatÃ©gorie</th>
        <th>Type</th>
        <th>Moyen</th>
        <th>Montant (â‚¬)</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let t of filteredTransactions$ | async" 
          [ngClass]="{'row-revenu': t.type === 'Revenu', 'row-depense': t.type === 'DÃ©pense'}">
        <td>{{ formatDate(t.date) }}</td>
        <td>{{ t.category }}</td>
        <td>{{ t.type }}</td>
        <td>{{ t.method }}</td>
        <td class="amount-cell">{{ t.amount | number:'1.2-2' }}</td>
        <td>{{ t.description }}</td>
      </tr>
      <tr *ngIf="(filteredTransactions$ | async)?.length === 0">
          <td colspan="6" class="no-data-row">Aucune transaction trouvÃ©e pour les filtres.</td>
      </tr>
    </tbody>
  </table>
</section>