<section class="form-container">
  <h3 *ngIf="isEditMode">‚úèÔ∏è Modifier Transaction #{{ transactionToEdit?.id }}</h3>
  <h3 *ngIf="!isEditMode">‚ûï Nouvelle Transaction</h3>

  <form [formGroup]="transactionForm" (ngSubmit)="onSubmit()">
    
    <div class="form-group">
      <label for="date">Date :</label>
      <input id="date" type="date" formControlName="date" required>
    </div>

    <div class="form-group">
      <label for="type">Type :</label>
      <select id="type" formControlName="type" required>
        <option value="D√©pense">D√©pense ( - )</option>
        <option value="Revenu">Revenu ( + )</option>
      </select>
    </div>

    <div class="form-group">
      <label for="amount">Montant (‚Ç¨) :</label>
      <input id="amount" type="number" formControlName="amount" min="0.01" step="0.01" required placeholder="0.00">
      <div *ngIf="transactionForm.get('amount')?.invalid && transactionForm.get('amount')?.touched" class="error-message">
        Montant requis et positif.
      </div>
    </div>

    <div class="form-group">
      <label for="category">Cat√©gorie principale :</label>
      <select id="category" formControlName="category" required>
        <option value="" disabled>Choisir une cat√©gorie...</option>
        <option *ngFor="let cat of budgetService.categories()" [value]="cat">{{ cat }}</option>
      </select>
    </div>

    <div class="form-group" *ngIf="transactionForm.get('category')?.value">
      <label for="subcategory">Sous-cat√©gorie :</label>
      <select id="subcategory" formControlName="subcategory">
        <option value="">Aucune / G√©n√©ral</option>
        <option *ngFor="let subcat of availableSubcategories()" [value]="subcat">{{ subcat }}</option>
      </select>
    </div>
    
    <div class="form-group">
      <label for="method">Moyen de Paiement :</label>
      <select id="method" formControlName="method" required>
        <option value="" disabled>Choisir un moyen...</option>
        <option *ngFor="let m of methods" [value]="m">{{ m }}</option>
      </select>
    </div>

    <div class="form-group">
      <label for="description">Description (optionnel) :</label>
      <input id="description" type="text" formControlName="description" placeholder="Ex: Courses de la semaine">
    </div>

    <!-- NOUVEAU: Section Labels -->
    <div class="form-group">
      <label>üè∑Ô∏è Labels (optionnel) :</label>
      <div class="labels-selector">
        <button
          *ngFor="let label of budgetService.labels()"
          type="button"
          class="label-chip"
          [class.selected]="isLabelSelected(label.name)"
          [style.background-color]="isLabelSelected(label.name) ? label.color : 'transparent'"
          [style.border-color]="label.color"
          [style.color]="isLabelSelected(label.name) ? 'white' : label.color"
          (click)="toggleLabel(label.name)">
          <span *ngIf="label.icon">{{ label.icon }}</span>
          {{ label.name }}
        </button>
      </div>
      <p class="label-hint" *ngIf="selectedLabels().length > 0">
        {{ selectedLabels().length }} label(s) s√©lectionn√©(s)
      </p>
    </div>

    <div class="form-actions">
        <button type="submit" [disabled]="!transactionForm.valid">
            {{ isEditMode ? 'Enregistrer les modifications' : 'Enregistrer' }}
        </button>
        <button type="button" *ngIf="isEditMode" (click)="onCancel()" class="cancel-button">
            Annuler l'√©dition
        </button>
    </div>
  </form>
</section>